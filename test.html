<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"> 
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <title>Document</title>
</head>
<body>
    
    <div class="container">

        <div id="table_appointment"> 
            <h1>select * from appointment</h1> 
            <button onclick="call_api('GET','http://localhost/comp353_main_project/api/post/read_appointment.php', 'table_appointment')">Click me</button> 
        </div> 




        <div id="table_test"> 
            <h1>TEST UNIT</h1> 
            <button onclick="call_api('GET','http://localhost/comp353_main_project/api/post/read.php', 'table_test')">Click me</button> 
        </div> 
        <div id="table_test_2"> 
            <h1>TEST UNIT 2</h1> 
            <input type="text" id="ipt_test_2" value="3"><br><br>
            <button id="btn_test_2">Click me</button> 
            <script>
                document.getElementById("btn_test_2").onclick = function() {f_test_2()};
                function f_test_2() {
                    var url = "http://localhost/comp353_main_project/api/post/read_single.php?id="+document.getElementById("ipt_test_2").value;
                    call_api('GET',url, 'table_test_2');
                } 
            </script>
        </div> 





        <div id="table_1">
            <h1>read_1</h1> 
            <p>a. Get details of all dentists in all the clinics.             </p>
            <button onclick="call_api('GET','http://localhost/comp353_main_project/api/post/read_1.php', 'table_1')">Click me</button> 
        </div>


        <div id="table_2"> 
            <h1>read_2</h1> 
            <p>b. Get details of all appointments for a given dentist for a specific week.  </p>
            <input type="text" id="ipt_table_2_1" value="1"><br><br>
            <input type="text" id="ipt_table_2_2" value="2020-01-01"><br><br>
            <input type="text" id="ipt_table_2_3" value="2020-01-05"><br><br>
            <button id="btn_table_2">Click me</button> 
            <script>
                document.getElementById("btn_table_2").onclick = 
                function() {
                    var url = "http://localhost/comp353_main_project/api/post/read_2.php?"
                    +"Did="+document.getElementById("ipt_table_2_1").value
                    +"&d1="+document.getElementById("ipt_table_2_2").value
                    +"&d2="+document.getElementById("ipt_table_2_3").value
                    ; 
                    call_api('GET',url, 'table_2');
                } 
            </script>
        </div>

        <div id="table_3"> 
            <h1>read_3</h1> 
            <p>c. Get details of all appointments at a given clinic on a specific date. </p>
            <input type="text" id="ipt_table_3_1" value="clinic_1"><br><br>
            <input type="text" id="ipt_table_3_2" value="2020-01-01"><br><br> 
            <button id="btn_table_3">Click me</button> 
            <script>
                document.getElementById("btn_table_3").onclick = 
                function() {
                    var url = "http://localhost/comp353_main_project/api/post/read_3.php?"
                    +"clinic="+document.getElementById("ipt_table_3_1").value
                    +"&date="+document.getElementById("ipt_table_3_2").value 
                    ; 
                    call_api('GET',url, 'table_3');
                } 
            </script>
        </div>

        <div id="table_4"> 
            <h1>read_4</h1> 
            <p>d. Get details of all appointments of a given patient.  </p>
            <input type="text" id="ipt_table_4_1" value="123456789"><br><br> 
            <button id="btn_table_4">Click me</button> 
            <script>
                document.getElementById("btn_table_4").onclick = 
                function() {
                    var url = "http://localhost/comp353_main_project/api/post/read_4.php?"
                        +"sin="+document.getElementById("ipt_table_4_1").value
                        ; 
                    call_api('GET',url, 'table_4');
                } 
            </script>
        </div>

        <div id="table_5">
            <h1>read_5</h1> 
            <p>e. Get the number of missed appointments for each patient (only for patients who have missed at least 1 appointment). </p>
            <button onclick="call_api('GET','http://localhost/comp353_main_project/api/post/read_5.php', 'table_5')">Click me</button> 
        </div>

        <div id="table_6"> 
            <h1>read_6</h1> 
            <p>f. Get details of all the treatments made during a given appointment.  </p>
            <h4>See all appointement:</h4>
            <div id="table_6_appointment"> 
                <h1>select * from appointment</h1> 
                <button onclick="call_api('GET','http://localhost/comp353_main_project/api/post/read_appointment.php', 'table_6_appointment')">See appointment</button> 
            </div> 
            <label>Appointement ID: <input type="text" id="ipt_table_6_1" value="2"></label><br><br> 
            <button id="btn_table_6">Click me</button> 
            <script>
                document.getElementById("btn_table_6").onclick = 
                function() {
                    var url = "http://localhost/comp353_main_project/api/post/read_6.php?"
                        +"Aid="+document.getElementById("ipt_table_6_1").value
                        ; 
                    call_api('GET',url, 'table_6');
                } 
            </script>
        </div>





    </div>



    <script>  
        function call_api(mode, url, dst){
            console.log("========================================================");
            console.log("URL: " + url);
            var elementExistID = 'el#'+dst;
            if (document.contains(document.getElementById(elementExistID))) {
                console.log(elementExistID + " does existed, refreshing...")
                document.getElementById(elementExistID).remove();
            }  

            
            
            var request = new XMLHttpRequest() 
            request.open(mode, url, true) 
            request.onload = function() {  
                var data = JSON.parse(this.response)  



                console.log(data.length)
                if(!data.length && data.error){   // data is empty
                    console.log("EMPTY")
                    var error_message = '<p id=\'el#' + dst + '\'>Table is empty</p>'
                    $('#'+dst).append(error_message);  
                } else {
                    create_table('#'+dst, data)
                }
                
            } 
            request.send()
        }


        function create_table(dst, data){
            console.log("JSON receive:")
            console.log(data) 
            // console.log(data.length)

            // !data.length: DATA HAS ONLY ONE LINE
            if(!data.length){
                console.log("SINGLE LINE")
                console.log("CREATING TABLE...") 
                var table = '<table border=3 id=\'el' + dst + '\'>' ; 
                // table head
                table+='<tr>'; 
                var data_length = 0;
                for(el in data) { 
                    data_length++;
                    table += '<th>' + el + '</th>'; 
                }
                table+='</tr>'; 
                // table data
                for(i = 0; i <  1; i++){ 
                    table+='<tr>'
                    for (var key in data)  table+='<td>'+data[key]+'</td>' 
                    table+='</tr>'
                } 
                table+='</table>'
                console.log(table);
                $(dst).append(table); 
                
            // data.length: DATA HAS MULTIPLE LINE
            } else {
                console.log("CREATING TABLE...")
                console.log(data.length)
                var table = '<table border=3 id=\'el' + dst + '\'>' ; 
                // table head
                table+='<tr>'; 
                    
                for(el in data[0]) { 
                    table += '<th>' + el + '</th>'; 
                }
                table+='</tr>'; 
                // table data
                for(i = 0; i < data.length; i++){ 
                    table+='<tr>'
                    for (var key in data[i])  table+='<td>'+data[i][key]+'</td>' 
                    table+='</tr>'
                } 
                table+='</table>'
                console.log(table);
                $(dst).append(table); 
            }
            
        }
        </script>
</body>
</html>